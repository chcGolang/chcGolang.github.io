<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Msql故障处理和优化 | Chc</title><meta name="description" content="Msql故障处理和优化"><meta name="keywords" content><meta name="author" content="Chc"><meta name="copyright" content="Chc"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="http://qiniu.caihc.site/hexo/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="https://blog.caihc.site/posts/20161927/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Msql故障处理和优化"><meta name="twitter:description" content="Msql故障处理和优化"><meta name="twitter:image" content="http://qiniu.caihc.site/mysql/mysql%E4%BC%98%E5%8C%96.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Msql故障处理和优化"><meta property="og:url" content="https://blog.caihc.site/posts/20161927/"><meta property="og:site_name" content="Chc"><meta property="og:description" content="Msql故障处理和优化"><meta property="og:image" content="http://qiniu.caihc.site/mysql/mysql%E4%BC%98%E5%8C%96.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Mysql数据库设计规范" href="https://blog.caihc.site/posts/100de5f8/"><link rel="next" title="Mysql基本运维知识总结" href="https://blog.caihc.site/posts/b60c2e78/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://blog.caihc.site/","msgToTraditionalChinese":"简","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库访问故障处理"><span class="toc-number">1.</span> <span class="toc-text">数据库访问故障处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Access-denied-for-user-‘root’-’xxx-xxx-xxx-xxx’-using-password-YES"><span class="toc-number">1.0.1.</span> <span class="toc-text">Access denied for user ‘root’@’xxx.xxx.xxx.xxx’ (using password: YES)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ERROR-1153-08S01-at-line-38-Got-a-packet-bigger-than-‘max-allowed-packet’-bytes"><span class="toc-number">1.0.2.</span> <span class="toc-text">ERROR 1153 (08S01) at line 38: Got a packet bigger than ‘max_allowed_packet’ bytes</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#Sql优化"><span class="toc-number">2.</span> <span class="toc-text">Sql优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sql改写优化"><span class="toc-number">2.1.</span> <span class="toc-text">Sql改写优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分页查询优化案例"><span class="toc-number">2.2.</span> <span class="toc-text">分页查询优化案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方案1"><span class="toc-number">2.2.1.</span> <span class="toc-text">方案1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分区间统计"><span class="toc-number">2.3.</span> <span class="toc-text">分区间统计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL执行计划"><span class="toc-number">3.</span> <span class="toc-text">SQL执行计划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#执行计划返回的结果解析"><span class="toc-number">3.1.</span> <span class="toc-text">执行计划返回的结果解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#id列"><span class="toc-number">3.1.1.</span> <span class="toc-text">id列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-type"><span class="toc-number">3.1.2.</span> <span class="toc-text">select_type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#table"><span class="toc-number">3.1.3.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#type"><span class="toc-number">3.1.4.</span> <span class="toc-text">type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extra"><span class="toc-number">3.1.5.</span> <span class="toc-text">extra</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#possible-keys"><span class="toc-number">3.1.6.</span> <span class="toc-text">possible_keys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key"><span class="toc-number">3.1.7.</span> <span class="toc-text">key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他"><span class="toc-number">3.1.8.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行计划的限制"><span class="toc-number">3.2.</span> <span class="toc-text">执行计划的限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql捕获有问题的sql-慢查询日志"><span class="toc-number">3.3.</span> <span class="toc-text">mysql捕获有问题的sql (慢查询日志)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#阻塞"><span class="toc-number">4.</span> <span class="toc-text">阻塞</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#死锁"><span class="toc-number">5.</span> <span class="toc-text">死锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#死锁监控"><span class="toc-number">5.1.</span> <span class="toc-text">死锁监控</span></a></li></ol></li></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://qiniu.caihc.site/mysql/mysql%E4%BC%98%E5%8C%96.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Chc</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="http://qiniu.caihc.site/hexo/hear.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Msql故障处理和优化</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-20<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-21</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/mysql/">mysql</a></span></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="数据库访问故障处理"><a href="#数据库访问故障处理" class="headerlink" title="数据库访问故障处理"></a>数据库访问故障处理</h1><h3 id="Access-denied-for-user-‘root’-’xxx-xxx-xxx-xxx’-using-password-YES"><a href="#Access-denied-for-user-‘root’-’xxx-xxx-xxx-xxx’-using-password-YES" class="headerlink" title="Access denied for user ‘root’@’xxx.xxx.xxx.xxx’ (using password: YES)"></a><strong>Access denied for user ‘root’@’xxx.xxx.xxx.xxx’ (using password: YES)</strong></h3><ol>
<li><p>密码不正确</p>
</li>
<li><p>未对IP进行授权,<code>%</code>不包含<code>localhost</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> 账户名@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'账户密码'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>网络是否畅通</p>
</li>
</ol>
<h3 id="ERROR-1153-08S01-at-line-38-Got-a-packet-bigger-than-‘max-allowed-packet’-bytes"><a href="#ERROR-1153-08S01-at-line-38-Got-a-packet-bigger-than-‘max-allowed-packet’-bytes" class="headerlink" title="ERROR 1153 (08S01) at line 38: Got a packet bigger than ‘max_allowed_packet’ bytes"></a><strong>ERROR 1153 (08S01) at line 38: Got a packet bigger than ‘max_allowed_packet’ bytes</strong></h3><ul>
<li><p>问题原因:<code>Mysql</code>接收数据包问题</p>
</li>
<li><p>解决方法:</p>
<ol>
<li><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="comment"># 在最后添加一行：</span></span><br><span class="line">max_allowed_packet=16M</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql命令行执行命令</span></span><br><span class="line"><span class="comment"># 单位是字节,这里设置位置16M</span></span><br><span class="line"><span class="keyword">SET</span> PERSIST max_allowed_packet=<span class="number">16</span>*<span class="number">1024</span>*<span class="number">1024</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h1 id="Sql优化"><a href="#Sql优化" class="headerlink" title="Sql优化"></a>Sql优化</h1><h2 id="Sql改写优化"><a href="#Sql改写优化" class="headerlink" title="Sql改写优化"></a>Sql改写优化</h2><ul>
<li>使用<code>outer join</code>代替<code>not in</code></li>
<li>使用<code>CTE</code>代替子查询 (版本要求:<code>Mysql8.0</code>)</li>
<li>拆分复杂的大<code>SQL</code>为多个简单的小<code>SQL</code></li>
</ul>
<h2 id="分页查询优化案例"><a href="#分页查询优化案例" class="headerlink" title="分页查询优化案例"></a>分页查询优化案例</h2><h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><ul>
<li><p>未优化前 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> customer_id,title,<span class="keyword">content</span> <span class="keyword">FROM</span> <span class="string">'product_comment'</span></span><br><span class="line"><span class="keyword">WHERE</span> audit_status =<span class="number">1</span> <span class="keyword">AND</span> product_id = <span class="number">199726</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>优化版的 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.customer_id,t.title,t.content <span class="keyword">FROM</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">'comment_id'</span></span><br><span class="line">    <span class="keyword">FROM</span> product_comment</span><br><span class="line">    <span class="keyword">WHERE</span> product_id=<span class="number">199727</span> <span class="keyword">AND</span> audit_status=l <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">15</span> </span><br><span class="line">) a <span class="keyword">JOIN</span> product_comment t </span><br><span class="line">    <span class="keyword">ON</span> a.comment_id = t.comment_id:</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="分区间统计"><a href="#分区间统计" class="headerlink" title="分区间统计"></a>分区间统计</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">IFNULL</span>(total_money,<span class="number">0</span>) &gt;= <span class="number">1000</span> <span class="keyword">THEN</span> a.customer_id <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="string">'大于1000'</span></span><br><span class="line">,<span class="keyword">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">IFNULL</span>(total_money,<span class="number">0</span>) &gt;= <span class="number">800</span> <span class="keyword">THEN</span> a.customer_id <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="string">'800-1000'</span></span><br><span class="line">,<span class="keyword">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">IFNULL</span>(total_money,<span class="number">0</span>) &gt;= <span class="number">500</span> <span class="keyword">THEN</span> a.customer_id <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="string">'500-800'</span></span><br><span class="line">,<span class="keyword">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">IFNULL</span>(total_money,<span class="number">0</span>) &lt; <span class="number">500</span> <span class="keyword">THEN</span> a.customer_id <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="string">'小于500'</span></span><br><span class="line"><span class="keyword">FROM</span> mc_userdb.customer_login a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">(<span class="keyword">SELECT</span> customer_id,<span class="keyword">SUM</span>(order_money) <span class="keyword">AS</span> total_money <span class="keyword">FROM</span> mc_orderdb.order_master <span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_id) b</span><br><span class="line"><span class="keyword">ON</span> a.customer_id=b.customer_id</span><br></pre></td></tr></table></figure>

<h1 id="SQL执行计划"><a href="#SQL执行计划" class="headerlink" title="SQL执行计划"></a>SQL执行计划</h1><ul>
<li>如何查看sql的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">[SQL语句]</span><br><span class="line"></span><br><span class="line"># 例如:</span><br><span class="line">EXPLAIN</span><br><span class="line">SELECT * FROM &apos;user_info&apos; WHERE user_id=2</span><br></pre></td></tr></table></figure>

<h2 id="执行计划返回的结果解析"><a href="#执行计划返回的结果解析" class="headerlink" title="执行计划返回的结果解析"></a>执行计划返回的结果解析</h2><h3 id="id列"><a href="#id列" class="headerlink" title="id列"></a>id列</h3><ul>
<li>id列中的数据为一组数字,表示执行SELECT语句的顺序</li>
<li>id值相同时,执行顺序由上至下</li>
<li>id值越大优先级越高,越先被执行</li>
</ul>
<h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>SIMPLE</td>
<td>不包含子查询或是UNION操作的查询</td>
</tr>
<tr>
<td>PRIMARY</td>
<td>查询中如果包含任何子查询,那么最外层的查询则标记为PRIMARY</td>
</tr>
<tr>
<td>SUBQUERY</td>
<td>SELECT列表中的子查询</td>
</tr>
<tr>
<td>DEPENDENT SUBQUERY</td>
<td>依赖外部结果的子查询</td>
</tr>
<tr>
<td>UNION RESULT</td>
<td>UNION产生的结果集</td>
</tr>
<tr>
<td>DERIVED</td>
<td>出现在FROM字句中的子查询</td>
</tr>
<tr>
<td>UNION</td>
<td>UNION操作的第二个或是之后的查询的值为union</td>
</tr>
<tr>
<td>DERIVED</td>
<td>出现在FROM字句中的子查询</td>
</tr>
</tbody></table>
<h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><ul>
<li>输出数据行所在的表的名称</li>
<li>&lt;unionM,N&gt;由ID为M,N查询union产生的结果集</li>
<li><derivedn>/<subqueryn>由id为N的查询产生的结果</subqueryn></derivedn></li>
</ul>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><table>
<thead>
<tr>
<th>值(性能由高到低)</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>system</td>
<td>这是const联接类型的一个特例,当查询的表只有一行时使用</td>
</tr>
<tr>
<td>const</td>
<td>表中有且只有一个匹配的行时使用,如对主键或是唯一索引的查询,这是效率最高的联接方式</td>
</tr>
<tr>
<td>eq_ref</td>
<td>唯一索引或主键查找,对于每个索引建,表中只有一条记录与之匹配</td>
</tr>
<tr>
<td>ref</td>
<td>非唯一索引查找,返回匹配某个单独值的所有行</td>
</tr>
<tr>
<td>ref_or_null</td>
<td>类似ref类型的查询,但是附加了对NULL值列的查询</td>
</tr>
<tr>
<td>index_merge</td>
<td>该联接类型表示使用了索引合并优化方法</td>
</tr>
<tr>
<td>range</td>
<td>索引范围扫描,常见于between,&gt;,&lt;这里的查询条件</td>
</tr>
<tr>
<td>index</td>
<td>FULL index Scan全索引扫描,同ALL的区别是,遍历的是索引树</td>
</tr>
<tr>
<td>ALL</td>
<td>FULL TABLE Scan 全表扫描,这是效率最差的联接方式</td>
</tr>
</tbody></table>
<h3 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h3><table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Distinct</td>
<td>优化distinct操作,在找到第一匹配的元组后即停止找同样值的动作</td>
</tr>
<tr>
<td>Not exists</td>
<td>使用not exists来优化查询</td>
</tr>
<tr>
<td>Using filesort</td>
<td>使用额外操作进行排序,通常会出现在order by或group by查询中</td>
</tr>
<tr>
<td>Using index</td>
<td>使用了覆盖索引进行查询</td>
</tr>
<tr>
<td>Using temporary</td>
<td>mysql需要使用临时表来处理查询,常见于排序,子查询和分组查询</td>
</tr>
<tr>
<td>Using where</td>
<td>需要在mysql服务器层使用where条件来过滤数据</td>
</tr>
<tr>
<td>select tables optimized away</td>
<td>直接通过索引来获得数据,不用访问表</td>
</tr>
</tbody></table>
<h3 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h3><ul>
<li>指出mysql能使用那些索引来优化查询</li>
<li>查询列所涉及到的列上的索引都会被列出但不一定被使用</li>
</ul>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><ul>
<li>查询优化器优化查询实际所使用的索引</li>
<li>如果没有可用的索引,则显示为Null</li>
<li>如果查询使用了覆盖索引,则该索引仅出现在key列中</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>possible_keys</td>
<td>1. 指出mysql能使用那些索引来优化查询 2. 查询列所涉及到的列上的索引都会被列出但不一定被使用</td>
</tr>
<tr>
<td>ref</td>
<td>表示那些列或常量被用查找索引列上的值</td>
</tr>
<tr>
<td>key_len</td>
<td>1. 表示索引字段的最大可能长度 2. key_len的长度由字段定义计算而来,并非数据的实际长度</td>
</tr>
<tr>
<td>partitions</td>
<td>1. 对于分区表,显示查询的分区Id 2. 对于非分区表,显示为NULL</td>
</tr>
<tr>
<td>rows</td>
<td>表示mysql通过索引统计信息,估算的所需读取的行数 rows值的大小是个统计抽样结果,并不十分准确</td>
</tr>
<tr>
<td>filtered</td>
<td>表示返回结果的行数占需读取行数的百分比 值越大越好 依赖统计信息的</td>
</tr>
</tbody></table>
<h2 id="执行计划的限制"><a href="#执行计划的限制" class="headerlink" title="执行计划的限制"></a>执行计划的限制</h2><ul>
<li>无法展示存储过程,触发器,udf对查询的影响</li>
<li>无法使用explain对存储过程进行分析</li>
<li>早期版本的mysql只支持select语句进行分析</li>
</ul>
<h2 id="mysql捕获有问题的sql-慢查询日志"><a href="#mysql捕获有问题的sql-慢查询日志" class="headerlink" title="mysql捕获有问题的sql (慢查询日志)"></a>mysql捕获有问题的sql (慢查询日志)</h2><ol>
<li>启动mysql慢查日志</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置日志存储位置</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log_file = /sql_log/show_log.log;</span><br><span class="line"><span class="comment"># 记录未使用索引的sql日志 </span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_queries_not_using_indexes = <span class="keyword">on</span>;</span><br><span class="line"><span class="comment"># 抓取执行超过多少时间的sql(秒)</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time = <span class="number">0.001</span>;</span><br><span class="line"><span class="comment"># 启动慢查询日志</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> low_query_log = <span class="keyword">on</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>分析慢查询日志</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow [日志位置/日志名称]</span><br><span class="line"><span class="comment"># mysqldumpslow slow-mysql.log</span></span><br></pre></td></tr></table></figure>

<h1 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h1><ul>
<li>由于不同锁之间的兼容关系,造成一个事务需要等待另一个事务释放其所占用的资源现象</li>
<li>阻塞查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> p2.<span class="string">`host`</span>                                                    Blockedhost, </span><br><span class="line">       p2.<span class="string">`user`</span>                                                    BlockedUser, </span><br><span class="line">       r.trx_id                                                     BlockedTrxId </span><br><span class="line">       , </span><br><span class="line">       r.trx_mysql_thread_id </span><br><span class="line">       BlockedThreadId, </span><br><span class="line">       <span class="keyword">Timestampdiff</span>(<span class="keyword">second</span>, r.trx_wait_started, <span class="keyword">CURRENT_TIMESTAMP</span>) WaitTime, </span><br><span class="line">       r.trx_query                                                  BlockedQuery </span><br><span class="line">       , </span><br><span class="line">       l.lock_table </span><br><span class="line">       BlockedTable, </span><br><span class="line">       m.<span class="string">`lock_mode`</span> </span><br><span class="line">       BlockedLockMode, </span><br><span class="line">       m.<span class="string">`lock_type`</span> </span><br><span class="line">       BlockedLockType, </span><br><span class="line">       m.<span class="string">`lock_index`</span> </span><br><span class="line">       BlockedLockIndex, </span><br><span class="line">       m.<span class="string">`lock_space`</span> </span><br><span class="line">       BlockedLockSpace, </span><br><span class="line">       m.lock_page </span><br><span class="line">       BlockedLockPage, </span><br><span class="line">       m.lock_rec </span><br><span class="line">       BlockedLockRec, </span><br><span class="line">       m.lock_data </span><br><span class="line">       BlockedLockData, </span><br><span class="line">       p.<span class="string">`host`</span> </span><br><span class="line">       blocking_host, </span><br><span class="line">       p.<span class="string">`user`</span> </span><br><span class="line">       blocking_user, </span><br><span class="line">       b.trx_id </span><br><span class="line">       BlockingTrxid, </span><br><span class="line">       b.trx_mysql_thread_id </span><br><span class="line">       BlockingThreadId, </span><br><span class="line">       b.trx_query </span><br><span class="line">       BlockingQuery, </span><br><span class="line">       l.<span class="string">`lock_mode`</span> </span><br><span class="line">       BlockingLockMode, </span><br><span class="line">       l.<span class="string">`lock_type`</span> </span><br><span class="line">       BlockingLockType, </span><br><span class="line">       l.<span class="string">`lock_index`</span> </span><br><span class="line">       BlockingLockIndex, </span><br><span class="line">       l.<span class="string">`lock_space`</span> </span><br><span class="line">       BlockingLockSpace, </span><br><span class="line">       l.lock_page </span><br><span class="line">       BlockingLockPage, </span><br><span class="line">       l.lock_rec </span><br><span class="line">       BlockingLockRec, </span><br><span class="line">       l.lock_data </span><br><span class="line">       BlockingLockData, </span><br><span class="line">       <span class="keyword">IF</span> (p.command = <span class="string">'Sleep'</span>, <span class="keyword">Concat</span>(p.time, <span class="string">' seconds'</span>), <span class="number">0</span>)      idel_in_trx </span><br><span class="line"><span class="keyword">FROM</span>   information_schema.innodb_lock_waits w </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.innodb_trx b </span><br><span class="line">               <span class="keyword">ON</span> b.trx_id = w.blocking_trx_id </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.innodb_trx r </span><br><span class="line">               <span class="keyword">ON</span> r.trx_id = w.requesting_trx_id </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.innodb_locks l </span><br><span class="line">               <span class="keyword">ON</span> w.blocking_lock_id = l.lock_id </span><br><span class="line">                  <span class="keyword">AND</span> l.<span class="string">`lock_trx_id`</span> = b.<span class="string">`trx_id`</span> </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.innodb_locks m </span><br><span class="line">               <span class="keyword">ON</span> m.<span class="string">`lock_id`</span> = w.<span class="string">`requested_lock_id`</span> </span><br><span class="line">                  <span class="keyword">AND</span> m.<span class="string">`lock_trx_id`</span> = r.<span class="string">`trx_id`</span> </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema. <span class="keyword">processlist</span> p </span><br><span class="line">               <span class="keyword">ON</span> p.id = b.trx_mysql_thread_id </span><br><span class="line">       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema. <span class="keyword">processlist</span> p2 </span><br><span class="line">               <span class="keyword">ON</span> p2.id = r.trx_mysql_thread_id </span><br><span class="line"><span class="keyword">ORDER</span>  <span class="keyword">BY</span> waittime <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>阻塞查询语义版</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>    </span><br><span class="line">p2.<span class="string">`HOST`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方host'</span>,</span><br><span class="line">p2.<span class="string">`USER`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方用户'</span>,</span><br><span class="line">r.trx_id <span class="keyword">AS</span> <span class="string">'被阻塞方事务id'</span>,    </span><br><span class="line">        r.trx_mysql_thread_id <span class="keyword">AS</span> <span class="string">'被阻塞方线程号'</span>,    </span><br><span class="line">        <span class="keyword">TIMESTAMPDIFF</span>(    </span><br><span class="line">            <span class="keyword">SECOND</span>,    </span><br><span class="line">            r.trx_wait_started,    </span><br><span class="line">            <span class="keyword">CURRENT_TIMESTAMP</span>    </span><br><span class="line">        ) <span class="keyword">AS</span> <span class="string">'等待时间'</span>,    </span><br><span class="line">        r.trx_query <span class="keyword">AS</span> <span class="string">'被阻塞的查询'</span>,    </span><br><span class="line">        l.lock_table <span class="keyword">AS</span> <span class="string">'阻塞方锁住的表'</span>,  </span><br><span class="line">        m.<span class="string">`lock_mode`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方的锁模式'</span>,</span><br><span class="line">        m.<span class="string">`lock_type`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方的锁类型(表锁还是行锁)'</span>,</span><br><span class="line">        m.<span class="string">`lock_index`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方锁住的索引'</span>,</span><br><span class="line">        m.<span class="string">`lock_space`</span> <span class="keyword">AS</span> <span class="string">'被阻塞方锁对象的space_id'</span>,</span><br><span class="line">        m.lock_page <span class="keyword">AS</span> <span class="string">'被阻塞方事务锁定页的数量'</span>,</span><br><span class="line">        m.lock_rec <span class="keyword">AS</span> <span class="string">'被阻塞方事务锁定行的数量'</span>,</span><br><span class="line">        m.lock_data <span class="keyword">AS</span> <span class="string">'被阻塞方事务锁定记录的主键值'</span>, </span><br><span class="line">        p.<span class="string">`HOST`</span> <span class="keyword">AS</span> <span class="string">'阻塞方主机'</span>, </span><br><span class="line">        p.<span class="string">`USER`</span> <span class="string">'阻塞方用户'</span>,</span><br><span class="line">        b.trx_id <span class="keyword">AS</span> <span class="string">'阻塞方事务id'</span>,    </span><br><span class="line">        b.trx_mysql_thread_id <span class="keyword">AS</span> <span class="string">'阻塞方线程号'</span>,</span><br><span class="line">        b.trx_query <span class="keyword">AS</span> <span class="string">'阻塞方查询'</span>,</span><br><span class="line">        l.<span class="string">`lock_mode`</span> <span class="keyword">AS</span> <span class="string">'阻塞方的锁模式'</span>,</span><br><span class="line">        l.<span class="string">`lock_type`</span> <span class="keyword">AS</span> <span class="string">'阻塞方的锁类型(表锁还是行锁)'</span>,</span><br><span class="line">        l.<span class="string">`lock_index`</span> <span class="keyword">AS</span> <span class="string">'阻塞方锁住的索引'</span>,</span><br><span class="line">        l.<span class="string">`lock_space`</span> <span class="keyword">AS</span> <span class="string">'阻塞方锁对象的space_id'</span>,</span><br><span class="line">        l.lock_page <span class="keyword">AS</span> <span class="string">'阻塞方事务锁定页的数量'</span>,</span><br><span class="line">        l.lock_rec <span class="keyword">AS</span> <span class="string">'阻塞方事务锁定行的数量'</span>,</span><br><span class="line">        l.lock_data <span class="keyword">AS</span> <span class="string">'阻塞方事务锁定记录的主键值'</span>,         </span><br><span class="line">       <span class="keyword">IF</span> (p.COMMAND = <span class="string">'Sleep'</span>, <span class="keyword">CONCAT</span>(p.TIME,<span class="string">' seconds'</span>), <span class="number">0</span>) <span class="keyword">AS</span> <span class="string">'阻塞方事务空闲的时间'</span>             </span><br><span class="line">    <span class="keyword">FROM</span>    </span><br><span class="line">        information_schema.INNODB_LOCK_WAITS w    </span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.INNODB_TRX b <span class="keyword">ON</span> b.trx_id = w.blocking_trx_id    </span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.INNODB_TRX r <span class="keyword">ON</span> r.trx_id = w.requesting_trx_id    </span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.INNODB_LOCKS l <span class="keyword">ON</span> w.blocking_lock_id = l.lock_id  <span class="keyword">AND</span> l.<span class="string">`lock_trx_id`</span>=b.<span class="string">`trx_id`</span></span><br><span class="line">      <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.INNODB_LOCKS m <span class="keyword">ON</span> m.<span class="string">`lock_id`</span>=w.<span class="string">`requested_lock_id`</span> <span class="keyword">AND</span> m.<span class="string">`lock_trx_id`</span>=r.<span class="string">`trx_id`</span></span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema. <span class="keyword">PROCESSLIST</span> p <span class="keyword">ON</span> p.ID = b.trx_mysql_thread_id   </span><br><span class="line"> <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema. <span class="keyword">PROCESSLIST</span> p2 <span class="keyword">ON</span> p2.ID = r.trx_mysql_thread_id </span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span>    </span><br><span class="line">        <span class="string">'等待时间'</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果只有语句出现<code>[Err] 3167 - The ‘INFORMATION_SCHEMA.GLOBAL_STATUS’ feature is disabled; see the documentation for ‘show_compatibility_56’</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> show_compatibility_56=<span class="keyword">on</span>; </span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%show_compatibility_56%'</span>;</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| show_compatibility_56 | ON    |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br></pre></td></tr></table></figure>

<h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><ul>
<li>并行执行的多个事务相互占有了对方所需要的资源</li>
<li>方法1:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 1.查询是否锁表</span><br><span class="line">show OPEN TABLES where In_use &gt; 0;</span><br><span class="line"></span><br><span class="line"># 2.查询进程（如果您有SUPER权限，您可以看到所有线程。否则，您只能看到您自己的线程）</span><br><span class="line">show processlist</span><br><span class="line"></span><br><span class="line"># 3.杀死进程id（就是上面命令的id列）</span><br><span class="line">kill id</span><br></pre></td></tr></table></figure>

<ul>
<li>方法2:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.查看下在锁的事务 </span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> INFORMATION_SCHEMA.INNODB_TRX;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.杀死进程id（就是上面命令的trx_mysql_thread_id列）</span></span><br><span class="line"><span class="keyword">kill</span> 线程<span class="keyword">ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查出死锁进程：SHOW PROCESSLIST</span></span><br><span class="line"><span class="comment"># 杀掉进程          KILL 420821;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#其它关于查看死锁的命令：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1：查看当前的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> INFORMATION_SCHEMA.INNODB_TRX;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2：查看当前锁定的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3：查看当前等锁的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法3:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将死锁写入到错误日志中</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> <span class="keyword">innodb</span>-print_all-deadlocks=<span class="keyword">on</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="死锁监控"><a href="#死锁监控" class="headerlink" title="死锁监控"></a>死锁监控</h2><ul>
<li>使用pt工具</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pt-deadlock-logger u=[用户名],p=[密码],h=127.0.0.1 --create-dest-table --dest u=[用户名],p=[密码],h=127.0.0.1,D=crn,t=deadlock</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Chc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.caihc.site/posts/20161927/">https://blog.caihc.site/posts/20161927/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.caihc.site">Chc</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/posts/100de5f8/"><img class="prev_cover lozad" data-src="http://qiniu.caihc.site/mysql/mysql%E8%AE%BE%E8%AE%A1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Mysql数据库设计规范</span></div></a></div><div class="next-post pull-right"><a href="/posts/b60c2e78/"><img class="next_cover lozad" data-src="http://qiniu.caihc.site/mysql/mysql%E8%BF%90%E7%BB%B4.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Mysql基本运维知识总结</span></div></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By Chc</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">简</a><i class="fa fa-moon-o nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/baidupush.js"></script><script async src="/js/search/local-search.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/js/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>